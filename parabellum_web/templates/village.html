{% extends "layouts/base.html" %}
{% block title %}{{t!("game.village.title")}} â€“ PARABELLUM{% endblock %}
{% block body %}
{% if let Some(user) = current_user %}
  <div class="container mx-auto mt-4 md:mt-6 px-2 md:px-4 flex flex-col md:flex-row justify-center items-center md:items-start gap-8 pb-12">
      <div class="flex flex-col items-center w-full md:w-auto">
        <h1 class="text-xl font-bold mb-4 w-full text-left md:text-left">
          {{  user.village.name }} ({{  user.village.position.x }}|{{  user.village.position.y }})
        </h1>

          <div class="village-container-responsive relative">
              <a class="wall-ring-link"
                 href="/build?s=40"
                 title="{% if let Some(wall) = user.village.wall() %}{{t!("game.village.wall.occupied", name = wall.name, level = wall.level)}}{% else %}{{t!("game.village.wall.empty")}}{% endif %}"
                 aria-label="{% if let Some(wall) = user.village.wall() %}{{t!("game.village.wall.occupied", name = wall.name, level = wall.level)}}{% else %}{{t!("game.village.wall.empty")}}{% endif %}">
                  <svg class="wall-ring {% if user.village.wall().is_some() %}occupied{% endif %}"
                       viewBox="0 0 100 100"
                       role="img"
                       aria-hidden="true">
                      <title>{% if let Some(wall) = user.village.wall() %}{{t!("game.village.wall.occupied", name = wall.name, level = wall.level)}}{% else %}{{t!("game.village.wall.empty")}}{% endif %}</title>
                      <circle class="wall-ring-track" cx="50" cy="50" r="51"></circle>
                  </svg>
              </a>

              <a class="building-slot main-building {% if user.village.get_building_by_slot_id(19).is_some() %}occupied{% endif %}"
                   href="/build?s=19"
                   style="top: 50%; left: 50%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(19) %}{{t!("game.village.main_building_slot.occupied", level = slot.building.level)}}{% else %}{{t!("game.village.main_building_slot.empty")}}{% endif %}">
                  <span class="slot-label">{{t!("game.village.main_building")}}</span>
              </a>
              <a class="building-slot rally-point {% if user.village.get_building_by_slot_id(39).is_some() %}occupied{% endif %}"
                   href="/build?s=39"
                   style="top: 55%; left: 67%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(39) %}{{t!("game.village.rally_point.occupied", level = slot.building.level)}}{% else %}{{t!("game.village.rally_point.empty")}}{% endif %}"></a>

              <a class="building-slot {% if user.village.get_building_by_slot_id(20).is_some() %}occupied{% endif %}"
                   href="/build?s=20"
                   style="top: 28%; left: 47%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(20) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">1</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(21).is_some() %}occupied{% endif %}"
                   href="/build?s=21"
                   style="top: 35%; left: 63%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(21) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">2</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(22).is_some() %}occupied{% endif %}"
                   href="/build?s=22"
                   style="top: 37%; left: 32%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(22) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">3</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(23).is_some() %}occupied{% endif %}"
                   href="/build?s=23"
                   style="top: 72%; left: 53%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(23) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">4</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(24).is_some() %}occupied{% endif %}"
                   href="/build?s=24"
                   style="top: 63%; left: 38%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(24) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">5</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(25).is_some() %}occupied{% endif %}"
                   href="/build?s=25"
                   style="top: 52%; left: 27%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(25) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">6</span>
              </a>

              <a class="building-slot {% if user.village.get_building_by_slot_id(26).is_some() %}occupied{% endif %}"
                   href="/build?s=26"
                   style="top: 22%; left: 24%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(26) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">7</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(27).is_some() %}occupied{% endif %}"
                   href="/build?s=27"
                   style="top: 36%; left: 15%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(27) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">8</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(28).is_some() %}occupied{% endif %}"
                   href="/build?s=28"
                   style="top: 52%; left: 12%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(28) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">9</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(29).is_some() %}occupied{% endif %}"
                   href="/build?s=29"
                   style="top: 67%; left: 18%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(29) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">10</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(30).is_some() %}occupied{% endif %}"
                   href="/build?s=30"
                   style="top: 77%; left: 28%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(30) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">11</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(31).is_some() %}occupied{% endif %}"
                   href="/build?s=31"
                   style="top: 13%; left: 40%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(31) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">12</span>
              </a>

              <a class="building-slot {% if user.village.get_building_by_slot_id(32).is_some() %}occupied{% endif %}"
                   href="/build?s=32"
                   style="top: 86%; left: 43%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(32) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">13</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(33).is_some() %}occupied{% endif %}"
                   href="/build?s=33"
                   style="top: 85%; left: 60%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(33) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">14</span>
              </a>

              <a class="building-slot {% if user.village.get_building_by_slot_id(34).is_some() %}occupied{% endif %}"
                   href="/build?s=34"
                   style="top: 76%; left: 75%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(34) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">15</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(35).is_some() %}occupied{% endif %}"
                   href="/build?s=35"
                   style="top: 63%; left: 85%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(35) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">16</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(36).is_some() %}occupied{% endif %}"
                   href="/build?s=36"
                   style="top: 45%; left: 88%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(36) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">17</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(37).is_some() %}occupied{% endif %}"
                   href="/build?s=37"
                   style="top: 30%; left: 80%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(37) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">18</span>
              </a>
              <a class="building-slot {% if user.village.get_building_by_slot_id(38).is_some() %}occupied{% endif %}"
                   href="/build?s=38"
                   style="top: 15%; left: 62%;"
                   title="{% if let Some(slot) = user.village.get_building_by_slot_id(38) %}{{t!("game.village.slots.occupied", name = slot.building.name, level = slot.building.level)}}{% else %}{{t!("game.village.slots.empty")}}{% endif %}">
                  <span class="slot-label">19</span>
              </a>
          </div>
          {% include "partials/_building_queue.html" %}
      </div>

      <div class="w-full max-w-[400px] md:w-56 pt-4 md:pt-12 border-t md:border-t-0 border-gray-200 md:border-none">
          <h3 class="font-bold mb-3 text-sm border-b border-gray-300 pb-2">{{t!("game.village.villages")}}:</h3>
          <ul class="text-xs space-y-2 list-none pl-0">
              {% for village in user.villages %}
              <li class="flex justify-between items-center p-1 rounded {% if village.id == user.village.id %}font-bold bg-gray-100 cursor-default{% else %}cursor-pointer hover:bg-gray-100{% endif %}">
                  <span class="flex items-center">
                    <span class="w-2 h-2 rounded-full mr-2 {% if village.id == user.village.id %}bg-orange-500{% else %}bg-green-500{% endif %}"></span>
                    {{ village.name }}
                  </span>
                  <span class="{% if village.id == user.village.id %}text-gray-600{% else %}text-gray-500{% endif %}">
                    ({{ village.position.x }}|{{ village.position.y }})
                  </span>
              </li>
              {% endfor %}
          </ul>
      </div>
  </div>
{% else %}
  <div class="container mx-auto px-4 py-12 text-center text-gray-600">
    {{t!("errors.unauthorized")}}
  </div>
{% endif %}
{% endblock %}
